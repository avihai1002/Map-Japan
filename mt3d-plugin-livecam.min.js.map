{"version":3,"file":"mt3d-plugin-livecam.min.js","sources":["../node_modules/style-inject/dist/style-inject.es.js","../src/index.js","../node_modules/@fortawesome/fontawesome-free/svgs/solid/video.svg"],"sourcesContent":["function styleInject(css, ref) {\n  if ( ref === void 0 ) ref = {};\n  var insertAt = ref.insertAt;\n\n  if (!css || typeof document === 'undefined') { return; }\n\n  var head = document.head || document.getElementsByTagName('head')[0];\n  var style = document.createElement('style');\n  style.type = 'text/css';\n\n  if (insertAt === 'top') {\n    if (head.firstChild) {\n      head.insertBefore(style, head.firstChild);\n    } else {\n      head.appendChild(style);\n    }\n  } else {\n    head.appendChild(style);\n  }\n\n  if (style.styleSheet) {\n    style.styleSheet.cssText = css;\n  } else {\n    style.appendChild(document.createTextNode(css));\n  }\n}\n\nexport default styleInject;\n","import {Marker, Panel, Popup} from 'mini-tokyo-3d';\nimport livecamSVG from '@fortawesome/fontawesome-free/svgs/solid/video.svg';\nimport './livecam.css';\n\n// Live camera URL\nconst LIVECAM_URL = 'https://mini-tokyo.appspot.com/livecam';\n\nfunction addColor(url, color) {\n    const encodedColor = color.replace('#', '%23');\n    return url.replace('%3e', ` fill=\\'${encodedColor}\\' stroke=\\'${encodedColor}\\'%3e`);\n}\n\nfunction createElement(tagName, attributes, container) {\n    const element = document.createElement(tagName);\n\n    Object.assign(element, attributes);\n    if (container) {\n        container.appendChild(element);\n    }\n    return element;\n}\n\nclass LivecamPanel extends Panel {\n\n    constructor(options) {\n        super(Object.assign({className: 'livecam-panel'}, options));\n    }\n\n    addTo(map) {\n        const me = this,\n            {name, html} = me._options.camera;\n\n        me.setTitle(name[map.lang])\n            .setHTML(html);\n        return super.addTo(map);\n    }\n\n}\n\nclass LivecamPlugin {\n\n    constructor() {\n        const me = this;\n\n        me.id = 'livecam';\n        me.name = {\n            en: 'Live Cameras',\n            fr: 'Caméras en direct',\n            ja: 'ライブカメラ',\n            ko: '실시간 웹캠',\n            ne: 'प्रत्यक्ष क्यामेरा',\n            pt: 'Câmeras ao vivo',\n            th: 'กล้องถ่ายทอดสด',\n            'zh-Hans': '实时摄像头',\n            'zh-Hant': '實時攝像頭'\n        };\n        me.iconStyle = {\n            backgroundSize: '32px',\n            backgroundImage: `url(\"${addColor(livecamSVG, 'white')}\")`\n        };\n        me.clockModes = ['realtime'];\n        me.viewModes = ['ground'];\n        me.cameras = {};\n        me.markers = {};\n        me._onSelection = me._onSelection.bind(me);\n        me._onDeselection = me._onDeselection.bind(me);\n    }\n\n    onAdd(map) {\n        this.map = map;\n    }\n\n    onEnabled() {\n        const me = this,\n            {map, cameras} = me;\n\n        map.on('selection', me._onSelection);\n        map.on('deselection', me._onDeselection);\n\n        fetch(LIVECAM_URL).then(response => response.json()).then(data => {\n            for (const item of data) {\n                cameras[item.id] = item;\n            }\n            me._addMarkers();\n        });\n    }\n\n    onDisabled() {\n        const me = this,\n            {map} = me;\n\n        map.off('selection', me._onSelection);\n        map.off('deselection', me._onDeselection);\n\n        if (me.panel) {\n            map.trackObject();\n            me.panel.remove();\n            delete me.panel;\n        }\n\n        for (const id of Object.keys(me.cameras)) {\n            delete me.cameras[id];\n        }\n        for (const id of Object.keys(me.markers)) {\n            me.markers[id].remove();\n            delete me.markers[id];\n        }\n    }\n\n    onVisibilityChanged(visible) {\n        const me = this;\n\n        me.visible = visible;\n\n        if (!visible && me.panel) {\n            me.map.trackObject();\n        }\n        for (const id of Object.keys(me.markers)) {\n            me.markers[id].setVisibility(visible);\n        }\n    }\n\n    _addMarkers() {\n        const me = this,\n            {map, visible} = me,\n            {lang} = map;\n\n        for (const id of Object.keys(me.cameras)) {\n            const {center, zoom, bearing, pitch, name, thumbnail} = me.cameras[id],\n                element = createElement('div', {className: 'livecam-marker'}),\n                selection = {id, selectionType: 'livecam'};\n            let popup;\n\n            me.markers[id] = new Marker({element})\n                .setLngLat(center)\n                .addTo(map)\n                .setVisibility(visible)\n                .on('click', () => {\n                    map.trackObject(selection);\n                    map.getMapboxMap().flyTo({center, zoom, bearing, pitch});\n                })\n                .on('mouseenter', () => {\n                    popup = new Popup()\n                        .setLngLat(center)\n                        .setHTML([\n                            '<div class=\"thumbnail-image-container\">',\n                            '<div class=\"ball-pulse\"><div></div><div></div><div></div></div>',\n                            `<div class=\"thumbnail-image\" style=\"background-image: url(\\'${thumbnail}\\');\"></div>`,\n                            '</div>',\n                            `<div><strong>${name[lang]}</strong></div>`\n                        ].join(''))\n                        .addTo(map);\n                })\n                .on('mouseleave', () => {\n                    if (popup) {\n                        popup.remove();\n                        popup = undefined;\n                    }\n                });\n        }\n    }\n\n    _onSelection(event) {\n        if (event.selectionType === 'livecam') {\n            const me = this,\n                {id} = event;\n\n            me.markers[id].setActivity(true);\n            me.panel = new LivecamPanel({camera: me.cameras[id]}).addTo(me.map);\n        }\n    }\n\n    _onDeselection(event) {\n        if (event.selectionType === 'livecam') {\n            const me = this,\n                marker = me.markers[event.id];\n\n            if (marker) {\n                marker.setActivity(false);\n            }\n            if (me.panel) {\n                me.panel.remove();\n                delete me.panel;\n            }\n        }\n    }\n\n}\n\nexport default function() {\n    return new LivecamPlugin();\n}\n","var img = \"data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 576 512'%3e%3c!--! Font Awesome Free 6.4.0 by %40fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0%2c Fonts: SIL OFL 1.1%2c Code: MIT License) Copyright 2023 Fonticons%2c Inc. --%3e%3cpath d='M0 128C0 92.7 28.7 64 64 64H320c35.3 0 64 28.7 64 64V384c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64V128zM559.1 99.8c10.4 5.6 16.9 16.4 16.9 28.2V384c0 11.8-6.5 22.6-16.9 28.2s-23 5-32.9-1.6l-96-64L416 337.1V320 192 174.9l14.2-9.5 96-64c9.8-6.5 22.4-7.2 32.9-1.6z'/%3e%3c/svg%3e\";\n  export default img;"],"names":["css","ref","insertAt","document","head","getElementsByTagName","style","createElement","type","firstChild","insertBefore","appendChild","styleSheet","cssText","createTextNode","addColor","url","color","encodedColor","replace","tagName","attributes","container","element","Object","assign","LivecamPanel","Panel","constructor","options","super","className","addTo","map","name","html","this","_options","camera","setTitle","lang","setHTML","LivecamPlugin","me","id","en","fr","ja","ko","ne","pt","th","iconStyle","backgroundSize","backgroundImage","clockModes","viewModes","cameras","markers","_onSelection","bind","_onDeselection","onAdd","onEnabled","on","fetch","then","response","json","data","item","_addMarkers","onDisabled","off","panel","trackObject","remove","keys","onVisibilityChanged","visible","setVisibility","center","zoom","bearing","pitch","thumbnail","selection","selectionType","popup","Marker","setLngLat","getMapboxMap","flyTo","Popup","join","undefined","event","setActivity","marker"],"mappings":"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","x_google_ignoreList":[0,2]}